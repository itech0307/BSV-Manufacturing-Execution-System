{% extends 'common/main.html' %}
{% load i18n %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/report.css' %}">
<body>
<div class="report-container" id="dataContainer">
    <div class="report-row row" style="padding:10px">
        <div class="col-3">
            <h2>{% block header %}{% endblock %}</h2>
            {% block checkbox %}
            {% endblock %}
        </div>
        <div class="col-9">
            {% block forms %}
            {% endblock %}
            <div class="title-buttons" style="text-align: left; margin-top: 10px;">
                {% block action_buttons %}
                <button onclick="generateQRCode()" title="QR" style="background: none; border: none; cursor: pointer; margin: 0 10px;">
                    <i class="fas fa-qrcode"></i>
                </button>
                <button onclick="toggleSearchPopup()" title="Search" style="background: none; border: none; cursor: pointer; margin: 0 10px;">
                    <i class="fas fa-search"></i>
                </button>
                <button type="button" title="List Search" onclick="openListSearchModal();" style="background: none; border: none; cursor: pointer; margin: 0 10px;">
                    <i class="fas fa-paste"></i>
                </button>
                <button onclick="exportTableToExcel()" title="Download as Excel" style="background: none; border: none; cursor: pointer; margin: 0 10px;">
                    <i class="fas fa-file-excel"></i>
                </button>
                <button onclick="captureTableAsImage()" title="Capture" style="background: none; border: none; cursor: pointer; margin: 0 10px;">
                    <i class="fas fa-camera"></i>
                </button>
                {% endblock %}
            </div>
        </div>
    </div>
    <hr>
    {% block table %}
    {% endblock %}

    <!-- Search Popup Window -->
    <div id="searchPopup" class="popup">
        <!-- Add Form Tag: action is based on Django URLconf -->
        <form method="post" action="{% block url_search_popup %}{% endblock %}">
            {% csrf_token %}
            <div class="popup-content">
                <div>
                    <h5>OrderNo</h5>
                    <input type="search" id="orderNoInput" name="order_no" autocomplete="off" placeholder="Enter OrderNo">
                </div>
                <div>
                    <h5>Item</h5>
                    <input type="search" id="itemInput" name="item" autocomplete="off" placeholder="Enter Item">
                </div>
                <div>
                    <h5>ColorCode</h5>
                    <input type="search" id="colorCodeInput" name="color_code" autocomplete="off" placeholder="Enter ColorCode">
                </div>
                <div>
                    <h5>Pattern</h5>
                    <input type="search" id="patternInput" name="pattern" autocomplete="off" placeholder="Enter Pattern">
                </div>
                <div>
                    <h5>Customer</h5>
                    <input type="search" id="customerInput" name="customer" autocomplete="off" placeholder="Enter Customer">
                </div>
                <div>
                    <h5>OrderType</h5>
                    <input type="search" id="orderTypeInput" name="order_type" autocomplete="off" placeholder="Enter OrderType">
                </div>
                <div>
                    <h5>Start Date</h5>
                    <input type="date" id="startDateInput" name="start_date" autocomplete="off" value="{{ 30daysago|date:'Y-m-d' }}">
                </div>
                <div>
                    <h5>End Date</h5>
                    <input type="date" id="endDateInput" name="end_date" autocomplete="off" value="{{ today|date:'Y-m-d' }}">
                </div>
            </div>
        </form>
    </div>

    <!-- List Search Modal -->
    <div class="modal fade" id="listSearchModal" tabindex="-1" role="dialog" aria-labelledby="listSearchModalLabel" aria-hidden="true" style="z-index: 9999;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="listSearchModalLabel">{% trans 'Order List Search' %}</h5>
                </div>
                <form id="listOrderForm" method="post" action="{% block url_list_search %}{% endblock %}">
                    {% csrf_token %}
                    <div class="modal-body">
                        <textarea class="form-control" name="order_numbers" id="listOrderInput" rows="10" placeholder="Enter order numbers, one per line"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeListSearchModal();">{% trans 'Close' %}</button>
                        <button type="button" class="btn btn-primary" onclick="searchListOrders();">{% trans 'Search' %}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Context Menu -->
    <div id="context-menu" class="context-menu">
        <ul>
            <li onclick="action1()">Status Info</li>
            <li onclick="action2()">Add to mylist</li>
            <li onclick="action3()">Comment</li>
            <li onclick="action4()">To urgent</li>
        </ul>
    </div>

    <!-- Add Modal Window -->
    <div id="infoModal" class="modal" style="z-index: 9999;">
        <div class="modal-content" style="width:50%;">
            <span class="close">&times;</span>
            <h2>Status Information</h2>
            <p id="modalStatusInfo"></p>
        </div>
    </div>

</div>
{% endblock %}
{% block script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
<script>window.isProductionManager = {% if "production_managers" in user_groups %}true{% else %}false{% endif %};</script>
<script src="{% static 'js/base.js' %}"></script>
{% block extra_js %}{% endblock %}
</body>
{% endblock %}