{% extends 'base/core.html' %}
{% load static %}
{% block content %}
<h3>NEW ORDERS UPDATE</h3>
<form method="post" enctype="multipart/form-data">  {# Start form for file upload #}
{% csrf_token %}  {# Add CSRF token #}
<input type="file" name="importData">  {# File selection input #}
<input hidden type="text" name="title" value="NEW ORDERS UPDATE">  {# Hidden input for title #}
<button class="btn btn-primary" type="submit">Upload</button>  {# Import button #}
</form>
<hr>
<div class='progress-wrapper'>
    <div id='progress-bar' class='progress-bar' style="background-color: #68a9ef; width: 0%;">&nbsp;</div>
  </div>
<div id="progress-bar-message">Waiting for progress to start...</div>
<h3>Import History (Lastest 30 days) </h3>
<div style="height: 300px; overflow-y: auto;">
  <table class="table table-striped table-hover">
    <thead class="table-light">
      <tr>
        <th>Import Time</th>
        <th>User</th>
        <th>File Name</th>
        <th>Data Count</th>
      </tr>
    </thead>
    <tbody>
      {% for log in upload_logs %}
        <tr>
          <td>{{ log.upload_time|date:"Y-m-d H:i:s" }}</td>
          <td>{{ log.user.username }}</td>
          <td>{{ log.file_name }}</td>
          <td>{{ log.data_count }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" class="text-center">No import history in the last 30 days.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}  {# End content block #}
{% block script %}  {# Start script block #}
{% if task_id %}
<script src="{% static 'js/celery_progress.js' %}"></script>  {# Load Celery progress bar JavaScript file #}
<script type="text/javascript">
	$(function () {
		var progressUrl = "{% url 'celery_progress:task_status' task_id %}";  {# Set URL to get task status #}
		CeleryProgressBar.initProgressBar(progressUrl, {})  {# Initialize progress bar #}
	});
</script>
{% endif %}
{% endblock %}  {# End script block #}